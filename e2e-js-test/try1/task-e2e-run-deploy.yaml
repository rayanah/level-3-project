apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: e2e-test
spec:
  resources:
    inputs:
    - name: e2e-pr
      type: git
  params:
  - name: IMAGE
    description: Name (reference) of the image to build.
    default: "rayanah/e2e-tests"
  - name: IMAGE_TAG
    default: "latest"
  - name: pathToYamlFile
    type: string
    description: The path to the yaml file to deploy
    default: $(resources.inputs.e2e-pr.path)/e2e-js-test/e2e-dep.yaml
  - name: namespace
    default: test
  steps:
  - name: run-kubectl
    image: lachlanevenson/k8s-kubectl
    command: ["kubectl"]
    args:
      - "apply"
      - "-f"
      - "$(params.pathToYamlFile)"
      - "-n"
      - "$(params.namespace)"
  - name: run-test
    image: rayanah/e2e-tests
    script: |
      #!/bin/sh
       ls e2e-pr/e2e-js-test
       source e2e-pr/e2e-js-test/runner.sh
